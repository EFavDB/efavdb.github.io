<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Universal limiting mean return of CPPI investment portfolios</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="./universal-mean-return-formula-of-the-cppi-investment-strategy.html" rel="canonical" />
  <!-- Feed -->

  <link href="./theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="./theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="CPPI\(^{\dagger}\) is a risk management tactic that can be applied to any investment portfolio. The approach entails banking a...">

    <meta name="author" content="jslandy">

    <meta name="tags" content="finance">




<!-- Open Graph -->
<meta property="og:site_name" content="EFAVDB"/>
<meta property="og:title" content="Universal limiting mean return of CPPI investment portfolios"/>
<meta property="og:description" content="CPPI\(^{\dagger}\) is a risk management tactic that can be applied to any investment portfolio. The approach entails banking a..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./universal-mean-return-formula-of-the-cppi-investment-strategy.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-12-09 16:14:00-08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/jslandy.html">
<meta property="article:section" content="Finance"/>
<meta property="article:tag" content="finance"/>
<meta property="og:image" content="./theme/images/post-bg.jpg">

<!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@efavdb">
    <meta name="twitter:title" content="Universal limiting mean return of CPPI investment portfolios">
    <meta name="twitter:url" content="./universal-mean-return-formula-of-the-cppi-investment-strategy.html">

        <meta name="twitter:image:src" content="./theme/images/post-bg.jpg">

      <meta name="twitter:description" content="CPPI\(^{\dagger}\) is a risk management tactic that can be applied to any investment portfolio. The approach entails banking a...">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Universal limiting mean return of CPPI investment portfolios",
  "headline": "Universal limiting mean return of CPPI investment portfolios",
  "datePublished": "2019-12-09 16:14:00-08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "jslandy",
    "url": "./author/jslandy.html"
  },
  "image": "./theme/images/post-bg.jpg",
  "url": "./universal-mean-return-formula-of-the-cppi-investment-strategy.html",
  "description": "CPPI\(^{\dagger}\) is a risk management tactic that can be applied to any investment portfolio. The approach entails banking a..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="/" role="presentation">Home</a></li>
          <li><a href="/pages/about.html" role="presentation">About & Consulting</a></li>
          <li><a href="/archives.html" role="presentation">Archive</a></li>
          <li><a href="/tags.html" role="presentation">Tags</a></li>
          <li><a href="/pages/linselect.html" role="presentation">linselect - feature selection</a></li>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="./" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Universal limiting mean return of CPPI investment portfolios</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="./author/jslandy.html">Jslandy</a>
            | <time datetime="Mon 09 December 2019">Mon 09 December 2019</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>CPPI<span class="math">\(^{\dagger}\)</span> is a risk management tactic that can be applied to
any investment portfolio. The approach entails banking a percentage of
profits whenever a new all time high wealth is achieved, thereby
ensuring that a portfolio's drawdown never goes below some maximum
percentage. Here, I review CPPI and then consider the mean growth rate
of a CPPI portfolio. I find that in a certain, common limit, this mean
growth is given by a universal formula,
(\ref{cppi_asymptotic_growth}) below. This universal result does not
depend in detail on the statistics of the investment in question, but
instead only on its mean return and standard deviation. I illustrate
the formula's accuracy with a simulation in python.</p>
<p><span class="math">\(\dagger\)</span> CPPI = "Constant Proportion Portfolio Insurance"  </p>
<p><a href="http://twitter.com/efavdb">Follow @efavdb</a><br>
Follow us on twitter for new submission alerts!</p>
<h2>Introduction</h2>
<p>The drawdown of an investment portfolio at a given date is equal to
the amount of money lost relative to its maximum held capital up to
that date. This is illustrated in the figure at right -- a portfolio
that once held $100 now holds only $90, so the drawdown is currently
$10. <a href="http://efavdb.com/wp-content/uploads/2019/12/dd.png"><img alt="dd" src="http://efavdb.com/wp-content/uploads/2019/12/dd.png"></a>
CPPI is a method that can be applied to guarantee that the maximum
fractional drawdown is never more than some predetermined value -- the
idea is to simply squirrel away an appropriate portion of earnings
whenever we hit a new maximum account value, and only risk what's left
over from that point on. For example, to cap the max loss at 50%, one
should only risk 50% of the initial capital and then continue to bank
50% of any additional earnings whenever a new all time high is
reached.</p>
<p>According to Wikipedia, the first person to study CPPI was Perold, who derived the statistical properties of a CPPI portfolio's value at time <span class="math">\(t\)</span>, assuming the underlying stochastic investment follows a Wiener process. I was introduced to the CPPI concept by the book "Algorithmic Trading" by Ernest Chan. This book implicitly poses the question of what the mean return is for general, discrete investment strategies. Here, I show that a universal formula applies in this case, valid at low to modest leverages and small unit investment Sharpe ratios -- this result is given in equation (\ref{cppi_asymptotic_growth}) below.</p>
<p>The post proceeds as follows: In the next section, I define some notation and then write down the limiting result. In the following section, I give a numerical example in python. Finally, an appendix contains a derivation of the main result. This makes use of the universal limiting drawdown distribution result from my <a href="http://efavdb.com/universal-drawdown-statistics-in-investing/">prior post</a>.</p>
<h2>CPPI formulation and universal mean growth rate</h2>
<p>In this section, I review the CPPI strategy and give the limiting mean return result. Consider a portfolio that at time <span class="math">\(t\)</span> has value,<br>
</p>
<div class="math">$$
\begin{eqnarray}\tag{1}  
W_t = S_t + \Gamma_t
\end{eqnarray}
$$</div>
<p>
where <span class="math">\(W\)</span> is our total wealth, <span class="math">\(S\)</span> is the banked (safe) portion, and <span class="math">\(\\Gamma\)</span> is the portion we are willing to bet or gamble. The savings is set so that each time we reach a new all time high wealth, <span class="math">\(S\)</span> is adjusted to be equal to a fraction <span class="math">\(\Pi\)</span> of the net wealth. When this is done, the value of <span class="math">\(\Gamma\)</span> must also be adjusted downwards -- some of the investment money is moved to savings. Before adjustment, the result of a bet moves <span class="math">\(\Gamma\)</span> to<br>
</p>
<div class="math">\begin{eqnarray}\label{gamble_eom_cppi} \tag{2}
\tilde{\Gamma}_{t+1} \equiv \left (1 + f (g_{t} - 1)\right) \Gamma_t.
\end{eqnarray}</div>
<p><br>
Here, the tilde at left indicates this is the value before any reallocation is applied -- in case we have reached a new high, <span class="math">\(g_t\)</span> is a stochastic investment outcome variable, and <span class="math">\(f\)</span> is our "leverage" -- a constant that encodes how heavily we bet on the game. I will assume all <span class="math">\(g_i\)</span> are independent random variables that are identically distributed with distribution <span class="math">\(p(g)\)</span>. I will assume that <span class="math">\(f\)</span> is a fixed value throughout time, and will write<br>
</p>
<div class="math">\begin{eqnarray} \tag{3} \label{3}  
f = \frac{1}{\phi} \frac{ \langle g -1 \rangle }{ \text{var}(g)}  
\end{eqnarray}</div>
<p><br>
This re-parameterization helps to make the math work out more nicely below. It is also motivated by the Kelly formula, which specifies the gambling leverage that maximizes wealth at long times (here, setting <span class="math">\(\phi \to 1\)</span> gives the Kelly exposure).</p>
<p>The equations above define the CPPI scheme. The main result of this post is that in the limit where the leverage is not too high, and the stochastic <span class="math">\(g\)</span> has small Sharpe ratio (mean return over standard deviation), the mean log wealth at time <span class="math">\(t\)</span> satisfies<br>
</p>
<div class="math">\begin{eqnarray} \label{cppi_asymptotic_growth} \tag{4}  
\frac{1}{t}\langle \log W_{t} - \log W_{0} \rangle \sim \frac{ \langle g -1 \rangle^2 }{ \text{var}(g)} (1-\Pi) \frac{(2 \phi -1)}{2 \phi ^2}.  
\end{eqnarray}</div>
<p>
This result can be used to estimate the mean growth of a portfolio to which CPPI is applied. Before illustrating its accuracy via a simulation below, I highlight a few points about the result:</p>
<ol>
<li>The fact that (\ref{cppi_asymptotic_growth}) is universal makes it very practical to apply to a real world investment: Rather than having to estimate the full distribution for <span class="math">\(g\)</span>, we need only estimate its mean and variance to get an estimate for the portfolio's long-time mean return.</li>
<li>The mean return (\ref{cppi_asymptotic_growth}) is equivalent to that found by Perold for Gaussian processes -- as expected, since the result is "universal".</li>
<li>The maximum return at fixed <span class="math">\(\Pi\)</span> is again obtained at <span class="math">\(\phi = 1\)</span>, the Kelly maximum.</li>
<li>If <span class="math">\(\phi = 1/2\)</span>, we are at twice Kelly exposure and the mean return is zero -- this a well known result. At <span class="math">\(\phi &lt; 1/2\)</span>, we are above twice Kelly and the return is negative.</li>
<li>The mean return is reduced by a factor <span class="math">\((1-\Pi)\)</span> -- the fraction of new high wealths we are exposing to loss. It is interesting that the result is not suppressed faster than this as we hold out more wealth, given that we have lower exposure after a loss than we would otherwise.</li>
<li>One can ask what <span class="math">\(\phi\)</span> gives us the same mean return using CPPI as we would obtain at full exposure using <span class="math">\(\phi_0\)</span>. E.g., consider the case of <span class="math">\(\Pi = 1/2\)</span>, which corresponds to insuring that half of our wealth is protected from loss. Equating the mean gains of these two gives<br>
<div class="math">\begin{eqnarray}  
    \frac{1}{2} \frac{(2 \phi -1)}{2 \phi ^2} = \frac{(2 (2)-1)}{2 (2)^2} = \frac{3}{8}.  
    \end{eqnarray}</div>
<br>
    The two roots for <span class="math">\(\phi\)</span> are plotted versus <span class="math">\(\phi_0\)</span> below. <a href="./wp-content/uploads/2019/12/solution_half_safe.png"><img alt="solution_half_safe" src="./wp-content/uploads/2019/12/solution_half_safe.png"></a> Notice that we can't find solutions for all <span class="math">\(\phi_0\)</span> -- it's not possible to match the mean return for high leverages at full exposure when we force protection of some of our assets.</li>
</ol>
<p>We now turn to a simulation example.</p>
<h2>Python CPPI simulation</h2>
<p>In the code below, we consider a system where in each step we either "win" or "lose": If we win, the money we risk grows by a factor of <span class="math">\(f \times 1.02\)</span>, and if we lose, it goes down by a factor of <span class="math">\(f \times 1 / 1.02\)</span>. We take the probability of winning to be <span class="math">\(0.65\)</span>. This game has a Sharpe ratio of <span class="math">\(0.32\)</span>, small enough that our approximation should work well. The code below carries out a simulated repeated investment game over 100 trials -- we hope that it is clear what is happening at each step.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># investment definitions -- a random walk  </span>
<span class="n">LIFT_ON_WIN</span> <span class="o">=</span> <span class="mf">1.02</span>  
<span class="n">LIFT_ON_LOSS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">LIFT_ON_WIN</span>

<span class="n">P_WIN</span> <span class="o">=</span> <span class="mf">0.65</span>  
<span class="n">P_LOSS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">P_WIN</span>

<span class="n">g_minus_1_bar</span> <span class="o">=</span> <span class="n">P_WIN</span> <span class="o">*</span> <span class="p">(</span><span class="n">LIFT_ON_WIN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">P_LOSS</span> <span class="o">*</span> <span class="p">(</span><span class="n">LIFT_ON_LOSS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  
<span class="n">var_g</span> <span class="o">=</span> <span class="n">P_WIN</span> <span class="o">*</span> <span class="p">(</span><span class="n">LIFT_ON_WIN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">P_LOSS</span> <span class="o">*</span> <span class="p">(</span><span class="n">LIFT_ON_LOSS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">g_minus_1_bar</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  
<span class="n">full_kelly</span> <span class="o">=</span> <span class="n">g_minus_1_bar</span> <span class="o">/</span> <span class="n">var_g</span>

<span class="n">sharpe</span> <span class="o">=</span> <span class="n">g_minus_1_bar</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_g</span><span class="p">)</span>  
<span class="nb">print</span> <span class="s1">&#39;Sharpe ratio of g unit bet: </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sharpe</span>

<span class="k">def</span> <span class="nf">simulate_once</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>  
    <span class="n">initial_value</span> <span class="o">=</span> <span class="mf">1.0</span>  
    <span class="n">f</span> <span class="o">=</span> <span class="n">full_kelly</span> <span class="o">/</span> <span class="n">phi</span>

    <span class="n">current_nav</span> <span class="o">=</span> <span class="n">initial_value</span>  
    <span class="n">current_max</span> <span class="o">=</span> <span class="n">current_nav</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>  
        <span class="c1"># update current max  </span>
        <span class="n">current_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_nav</span><span class="p">,</span> <span class="n">current_max</span><span class="p">)</span>

        <span class="c1"># calculate current effective nav  </span>
        <span class="n">current_drawdown</span> <span class="o">=</span> <span class="n">current_max</span> <span class="o">-</span> <span class="n">current_nav</span>  
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">current_max</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">current_drawdown</span>

        <span class="c1"># play round of investment game  </span>
        <span class="n">dice_roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>  
        <span class="n">win</span> <span class="o">=</span> <span class="p">(</span><span class="n">dice_roll</span> \<span class="o">&lt;</span> <span class="n">P_WIN</span><span class="p">)</span>  
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">win</span>  
        <span class="n">g</span> <span class="o">=</span> <span class="n">LIFT_ON_WIN</span> <span class="o">*</span> <span class="n">win</span> <span class="o">+</span> <span class="n">LIFT_ON_LOSS</span> <span class="o">*</span> <span class="n">loss</span>  
        <span class="n">nav_change</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># update wealth  </span>
        <span class="n">current_nav</span> <span class="o">+=</span> <span class="n">nav_change</span>

    <span class="k">return</span> <span class="n">current_nav</span>

<span class="n">end_results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># kelly and cppi properties  </span>
<span class="n">PHI</span> <span class="o">=</span> <span class="mf">10.0</span>  
<span class="n">PI</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>  
<span class="n">STEPS</span> <span class="o">=</span> <span class="mi">1000</span>  
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># simulation loop  </span>
<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TRIALS</span><span class="p">):</span>  
<span class="n">end_nav</span> <span class="o">=</span> <span class="n">simulate_once</span><span class="p">(</span><span class="n">phi</span><span class="o">=</span><span class="n">PHI</span><span class="p">,</span> <span class="n">pi</span><span class="o">=</span><span class="n">PI</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">STEPS</span><span class="p">)</span>  
<span class="n">end_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_nav</span><span class="p">)</span>

<span class="n">theory</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_minus_1_bar</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">var_g</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">PI</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">PHI</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">PHI</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  
<span class="nb">print</span> <span class="s1">&#39;Experiment: </span><span class="si">%2.5f</span><span class="s1">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">end_results</span><span class="p">))</span> <span class="o">/</span> <span class="n">STEPS</span><span class="p">)</span>  
<span class="nb">print</span> <span class="s1">&#39;Theory: </span><span class="si">%2.5f</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">theory</span>

<span class="c1"># OUTPUT:  </span>
<span class="c1"># Sharpe ratio of g unit bet: 0.3249  </span>
<span class="c1"># Experiment: 0.00251  </span>
<span class="c1"># Theory: 0.00251  </span>
</pre></div>


<p>The last lines above show the output of our print statements. In particular, the last two lines show the mean growth rate observed over the 100 trials and the theoretical value (\ref{cppi_asymptotic_growth}) -- these agree to three decimal places.</p>
<p>Using a loop over <span class="math">\(\phi\)</span> values, I used the code above to obtain the plot below of mean returns vs <span class="math">\(\phi\)</span>. This shows that the limiting result works quite well over most <span class="math">\(\phi\)</span> -- though there is some systematic, modest discrepancy at small <span class="math">\(\phi\)</span>. This is expected as the quadratic expansion for log wealth used below starts to break down at high exposures. Nevertheless, the fit is qualitatively quite good at all <span class="math">\(\phi\)</span>. This suggests that our result (\ref{cppi_asymptotic_growth}) can be used for quick mean return forecasts for most practical, applied cases of CPPI.</p>
<p><a href="./wp-content/uploads/2019/12/mean_cppi_growth_rate.png"><img alt="mean_cppi_growth_rate" src="./wp-content/uploads/2019/12/mean_cppi_growth_rate.png"></a></p>
<h2>Appendix: Derivation of mean return</h2>
<p>We give a rough sketch here of a proof of (\ref{cppi_asymptotic_growth}). Our aim is to quickly get the universal form in a relatively clean way. Note that these results may be new, or perhaps well known to finance theorists -- I'm not sure.</p>
<p>To begin let us define<br>
</p>
<div class="math">\begin{eqnarray}  
\Gamma^*_t = \max_{t^{\prime} \leq t} \Gamma_t.  
\end{eqnarray}</div>
<p><br>
This is the maximum <span class="math">\(\Gamma\)</span> seen to date at time <span class="math">\(t\)</span>. Necessarily, this is the value of <span class="math">\(\Gamma\)</span> as of the most recent all time high preceeding <span class="math">\(t\)</span>. If <span class="math">\(\Gamma_t &lt; \Gamma^*_t\)</span>, we say that we are in drawdown by value <span class="math">\(\Gamma^*_t - \Gamma_t\)</span>. At all times, we have<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
S_t &amp;=&amp; \frac{\Pi}{1 - \Pi} \Gamma^*_t \\  
&amp;\equiv &amp; \rho \Gamma^*_t.  
\end{eqnarray}</div>
<p><br>
This result holds because the saved portion is <span class="math">\(\Pi\)</span> times the net wealth when we reach a new high and <span class="math">\(\Gamma^*\)</span> is what's left over, <span class="math">\((1 - \Pi)\)</span> times the net wealth at that time.</p>
<p>From the above definitions, our net wealth after a step is given by<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
W_{t+1} &amp;=&amp; W_{t} \left ( 1 + f(g_t -1) \frac{\Gamma_t}{W_{t}} \right ) \\ \nonumber  
&amp;=&amp; W_{t} \left ( 1 + f(g_t -1) \frac{\Gamma_t}{S_t + \Gamma_t} \right ) \\  
&amp;=&amp; W_{t} \left ( 1 + f(g_t -1) \frac{\frac{\Gamma_t}{\Gamma^*_t}}{\rho+ \frac{\Gamma_t}{\Gamma^*_t}} \right )  
\end{eqnarray}</div>
<p><br>
Iterating and taking the logarithm we obtain<br>
</p>
<div class="math">\begin{eqnarray}\nonumber \tag{A1} \label{A1}  
\log W_{t} &amp;=&amp; \log W_{0} + \sum_{i=0}^{t-1} \log \left ( 1 + f(g_i -1) \frac{\frac{\Gamma_i}{\Gamma^*_i}}{\rho+ \frac{\Gamma_i}{\Gamma^*_i}} \right ) \\  
&amp;\approx &amp; \log W_{0} + \sum_{i=0}^{t-1} f (g_i -1) \frac{\frac{\Gamma_i}{\Gamma^*_i}}{\rho+ \frac{\Gamma_i}{\Gamma^*_i}} - \frac{f^2}{2} \left ((g_i -1) \frac{\frac{\Gamma_i}{\Gamma^*_i}}{\rho+ \frac{\Gamma_i}{\Gamma^*_i}}\right)^2 + \ldots  
\end{eqnarray}</div>
<p><br>
The series expansion in the second line can be shown to converge quickly provided we have selected a leverage <span class="math">\(f\)</span> that always results in a small percentage change in our net wealth each step. Note that it is the breakdown of this expansion that causes the slight divergence at low <span class="math">\(\phi\)</span> in our last plot above.   </p>
<p>Our aim is to evaluate the average of the last equation. The first key point needed to do this is to note that at step <span class="math">\(i\)</span>, we have <span class="math">\(g_i\)</span> and <span class="math">\(\Gamma_i / \Gamma_i^*\)</span> independent (the outcome of the unit bet doesn't depend on how much we have to wager at this time). This allows us to factor the averages above into one over <span class="math">\(g\)</span> and over the <span class="math">\(\Gamma_i / \Gamma_i^*\)</span> distribution. The former is relatively easy to write down if we assume some properties for <span class="math">\(f\)</span> and <span class="math">\(g\)</span>. To proceed on the latter, we note that<br>
</p>
<div class="math">\begin{eqnarray}  
\log \frac{\Gamma_i}{\Gamma^*_i} = \log \Gamma_i - \log \Gamma^*_i  
\end{eqnarray}</div>
<p><br>
is the drawdown of a random walk, with steps defined by (\ref{gamble_eom_cppi}). We have argued in our last post that the tail of the distribution of this drawdown distribution is such that<br>
</p>
<div class="math">\begin{eqnarray}  
p( \log \Gamma_i - \log \Gamma^*_i = -k) \propto \exp(\alpha k).  
\end{eqnarray}</div>
<p><br>
where <span class="math">\(\alpha\)</span> is given in that post as an implicit function of the statistics of <span class="math">\(g\)</span>. This tail form will hold almost everywhere when the Sharpe ratio is small. We will assume this here.  </p>
<p>Using the change of variables rule, we get<br>
</p>
<div class="math">\begin{eqnarray}  
p\left(\frac{\Gamma_i}{\Gamma^*_i} = k\right) \sim \begin{cases}  
\alpha k^{\alpha - 1} &amp; \text{if } x \in (0, 1) \\  
0 &amp; \text{else}  
\end{cases}  
\end{eqnarray}</div>
<p><br>
Again, this is an approximation that assumes we spend relatively little time within one jump from the current all time high -- a result that will hold in the small Sharpe ratio limit. With this result, we obtain<br>
</p>
<div class="math">\begin{eqnarray}\nonumber \tag{A2} \label{A2}  
\left \langle \frac{\frac{\Gamma_i}{\Gamma^*_i}}{\rho+ \frac{\Gamma_i}{\Gamma^*_i}} \right \rangle &amp;\equiv &amp; \int_0^1 \frac{x}{\rho + x} \alpha x^{\alpha - 1} dx \\  
&amp;=&amp;\frac{\alpha \, _2F_1\left(1,\alpha +1;\alpha +2;-\frac{1}{\rho }\right)}{\rho (\alpha +1) }  
\end{eqnarray}</div>
<p><br>
Here, <span class="math">\(_2F_1\)</span> is the hypergeometric function. Similarly,<br>
</p>
<div class="math">\begin{eqnarray}\nonumber \tag{A3} \label{A3}  
\left \langle \left( \frac{\frac{\Gamma_i}{\Gamma^*_i}}{\rho+ \frac{\Gamma_i}{\Gamma^*_i}} \right)^2 \right \rangle &amp;\equiv &amp; \int_0^1 \left( \frac{x}{\rho + x} \right)^2 \alpha x^{\alpha - 1} dx \\  
&amp;=&amp; \frac{\alpha \left(\frac{\rho }{\rho +1}-\frac{(\alpha +1) \, _2F_1\left(1,\alpha  
+2;\alpha +3;-\frac{1}{\rho }\right)}{\alpha +2}\right)}{\rho ^2}  
\end{eqnarray}</div>
<p><br>
Note that both of the last two lines go to one as <span class="math">\(\rho \to 0\)</span>, the limit where we invest our entire net worth and protect nothing. In this case, the growth equations are just those for a fully invested account. If you plug the last two results into the second line of (\ref{A1}), you get an expression for the mean return.   </p>
<p>To get the above results, we assumed a small Sharpe ratio. Therefore, to simplify things, we can use the value of <span class="math">\(\alpha\)</span> that we derived in our last post that is valid in this limit. This was given by <span class="math">\(\alpha \sim 2 \mu / \sigma^2\)</span>, where <span class="math">\(\mu\)</span> and <span class="math">\(\sigma\)</span> and mean and standard deviation of the random walk. We now evaluate these to get an expression for <span class="math">\(\alpha\)</span> in terms of the statistics of <span class="math">\(g\)</span>. First, we note that the mean drift of <span class="math">\(\log \Gamma\)</span> is given by<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
\mu &amp;\equiv &amp; \langle \log(1 + f (g-1)) \rangle \\ \nonumber  
&amp;\sim &amp; f \langle g -1 \rangle - \frac{f^2}{2} \langle (g-1)^2 \rangle \\  
&amp;\sim &amp; f \langle g -1 \rangle - \frac{f^2}{2} \text{var}(g).  
\end{eqnarray}</div>
<p><br>
The last line follows from the assumption that the Sharpe ratio for <span class="math">\(g -1\)</span> is small, so that<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
\langle (g-1)^2 \rangle &amp;=&amp; \left ( \langle (g-1)^2 \rangle - \langle (g-1) \rangle^2 \right) + \langle (g-1) \rangle^2 \\  
&amp;=&amp; \text{var}(g) \left ( 1 + \frac{ \langle (g-1) \rangle^2}{\text{var}(g)} \right ).  
\end{eqnarray}</div>
<p><br>
Similarly, one can show that<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
\sigma^2 &amp;\equiv&amp; \text{var} \log(1 + f (g-1)) \\  
&amp;\sim &amp; f^2 \text{var}(g).  
\end{eqnarray}</div>
<p><br>
This gives<br>
</p>
<div class="math">\begin{eqnarray}\nonumber  
\alpha &amp;\sim &amp; 2 \frac{\mu}{\sigma^2} \\ \nonumber  
&amp;\sim &amp; 2 \frac{ f \langle g -1 \rangle - \frac{f^2}{2} \text{var}(g)}{ f^2 \text{var}(g)} \\  
&amp;=&amp; \frac{2}{f} \frac{ \langle g -1 \rangle }{ \text{var}(g)} - 1  
\end{eqnarray}</div>
<p><br>
The second term in the first line can be neglected because we require the change in value to be a small fraction of our net wealth. We anticipate applying the algorithm to values of <span class="math">\(f\)</span> of order <span class="math">\(f \sim O( \frac{ \langle g -1 \rangle }{ \text{var}(g)})\)</span>, so the above is <span class="math">\(O(1)\)</span>. If we plug these results into the limiting form for <span class="math">\(\alpha\)</span> and use (\ref{3}) for <span class="math">\(f\)</span>, we get<br>
</p>
<div class="math">\begin{eqnarray} \tag{A4} \label{A4}  
\alpha \sim 2 \phi -1.  
\end{eqnarray}</div>
<p><br>
We won't show the details, but if you plug (\ref{A2}), (\ref{A3}), and (\ref{A4}) into (\ref{A1}), this gives (\ref{cppi_asymptotic_growth}). To get there, you need to show that a big collapse of terms occurs in the two hypergeometric functions. This collapse can be derived using the series expansion for <span class="math">\(_2F_1\)</span> in about one page. The collapse of terms only occurs in the small Sharpe ratio limit, where <span class="math">\(\alpha\)</span> is given as above. We note that for some walks, an exponential form holds everywhere. In this case, the more general expression using <span class="math">\(_2F_1\)</span> applies even at high Sharpe ratios -- though we still require <span class="math">\(f\)</span> small.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Universal limiting mean return of CPPI investment portfolios&amp;url=./universal-mean-return-formula-of-the-cppi-investment-strategy.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=./universal-mean-return-formula-of-the-cppi-investment-strategy.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=./universal-mean-return-formula-of-the-cppi-investment-strategy.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="./tag/finance.html">finance</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <a class="post-nav-prev" href="./universal-drawdown-statistics-in-investing.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">Universal drawdown statistics in investing</h2>
                            <p class="post-nav-excerpt">We consider the equilibrium drawdown distribution for a biased random walk -- in the...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="./theme/js/script.js"></script>

</body>
</html>